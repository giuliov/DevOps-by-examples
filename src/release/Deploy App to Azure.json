{"id":3,"revision":12,"name":"Deploy App to Azure","createdBy":{"id":"859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","displayName":"Giulio Vian (Dev AAD)","uniqueName":"giulio.dev@casavian.eu","url":"https://app.vssps.visualstudio.com/Ad42bf46b-f950-454c-b2aa-0cce857edf5a/_apis/Identities/859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","imageUrl":"https://giuliovaad.visualstudio.com/_api/_common/identityImage?id=859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c"},"createdOn":"2016-10-14T20:25:47.413Z","modifiedBy":{"id":"859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","displayName":"Giulio Vian (Dev AAD)","uniqueName":"giulio.dev@casavian.eu","url":"https://app.vssps.visualstudio.com/Ad42bf46b-f950-454c-b2aa-0cce857edf5a/_apis/Identities/859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","imageUrl":"https://giuliovaad.visualstudio.com/_api/_common/identityImage?id=859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c"},"modifiedOn":"2016-10-25T10:53:16.830Z","variables":{"TargetResourceGroup":{"value":"devopsbyex01"},"ConnectionString":{"value":"Server=tcp:devopsbyex01sql.database.windows.net,1433;Initial Catalog=appdb;Persist Security Info=False;User ID=sqladmin;Password=Password.01;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"}},"environments":[{"id":3,"name":"Environment 1","rank":1,"owner":{"id":"859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","displayName":"Giulio Vian (Dev AAD)","uniqueName":"giulio.dev@casavian.eu","url":"https://app.vssps.visualstudio.com/Ad42bf46b-f950-454c-b2aa-0cce857edf5a/_apis/Identities/859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c","imageUrl":"https://giuliovaad.visualstudio.com/_api/_common/identityImage?id=859dfcc2-d96d-4cd0-8bc1-d3a9570e5b5c"},"variables":{},"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":7}]},"deployStep":{"id":8},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":9}]},"deployPhases":[{"deploymentInput":{"multiplier":{"value":"","parallel":false,"continueOnError":true},"skipArtifactsDownload":false,"timeoutInMinutes":0,"queueId":2,"demands":[],"enableAccessToken":false},"rank":1,"phaseType":1,"name":"Run on agent","workflowTasks":[{"taskId":"ce85a08b-a538-4d2b-8589-1d37a9ab970f","version":"*","name":"Execute Azure SQL : SqlTask","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"9815235f-e243-4dd6-93d0-8bb9c8092f4f","ServerName":"devopsbyex01sql.database.windows.net","DatabaseName":"appdb","SqlUsername":"sqladmin","SqlPassword":"Password.01","TaskNameSelector":"SqlTask","DacpacFile":"","SqlFile":"$(System.DefaultWorkingDirectory)/Compile & Publish/Database Scripts/ISO_3166-2_Schema.sql","SqlInline":"","PublishProfile":"","AdditionalArguments":"","SqlAdditionalArguments":"","InlineAdditionalArguments":"","IpDetectionMethod":"AutoDetect","StartIpAddress":"","EndIpAddress":"","DeleteFirewallRule":"true"}},{"taskId":"ce85a08b-a538-4d2b-8589-1d37a9ab970f","version":"*","name":"Execute Azure SQL : SqlTask","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"9815235f-e243-4dd6-93d0-8bb9c8092f4f","ServerName":"devopsbyex01sql.database.windows.net","DatabaseName":"appdb","SqlUsername":"sqladmin","SqlPassword":"Password.01","TaskNameSelector":"SqlTask","DacpacFile":"","SqlFile":"$(System.DefaultWorkingDirectory)/Compile & Publish/Database Scripts/ISO_3166-2_Dataset.sql","SqlInline":"","PublishProfile":"","AdditionalArguments":"","SqlAdditionalArguments":"","InlineAdditionalArguments":"","IpDetectionMethod":"AutoDetect","StartIpAddress":"","EndIpAddress":"","DeleteFirewallRule":"true"}},{"taskId":"a8515ec8-7254-4ffd-912c-86772e2b5962","version":"*","name":"Replace tokens in **\\*.ini","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"rootDirectory":"$(System.DefaultWorkingDirectory)","targetFiles":"**\\*.ini","encoding":"auto","writeBOM":"true","actionOnMissing":"warn","keepToken":"false","tokenPrefix":"#{","tokenSuffix":"}#"}},{"taskId":"91443475-df55-4874-944b-39253b558790","version":"*","name":"Run shell commands on remote machine","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"sshEndpoint":"774b907c-aaf1-479e-849e-1953e04ca20c","runOptions":"commands","commands":"sudo mkdir -p /opt/devops-by-examples/app\nsudo chown vmadmin /opt/devops-by-examples/app","scriptPath":"","args":"","failOnStdErr":"true"}},{"taskId":"67cec91b-0351-4c2f-8465-d74b3d2a2d96","version":"*","name":"Securely copy files to the remote machine","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"sshEndpoint":"774b907c-aaf1-479e-849e-1953e04ca20c","sourceFolder":"$(System.DefaultWorkingDirectory)/Compile & Publish/Published app/publish","contents":"**","targetFolder":"/opt/devops-by-examples/app","cleanTargetFolder":"true","overwrite":"true","flattenFolders":"false"}},{"taskId":"91443475-df55-4874-944b-39253b558790","version":"*","name":"Run shell script on remote machine","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"sshEndpoint":"774b907c-aaf1-479e-849e-1953e04ca20c","runOptions":"script","commands":"xxx","scriptPath":"$(System.DefaultWorkingDirectory)/Compile & Publish/App installer/install-app.sh","args":"","failOnStdErr":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true}}],"artifacts":[{"sourceId":"9a98d6ba-d874-4a38-bd0e-7f12a4b8f891:1","type":"Build","alias":"Compile & Publish","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://tfsprodweu2.app.visualstudio.com/Ad42bf46b-f950-454c-b2aa-0cce857edf5a/_permalink/_build/index?collectionId=1fe04a90-6116-437a-a208-f64a7711e8ff&projectId=9a98d6ba-d874-4a38-bd0e-7f12a4b8f891&definitionId=1","name":""},"definition":{"id":"1","name":"Compile & Publish"},"project":{"id":"9a98d6ba-d874-4a38-bd0e-7f12a4b8f891","name":"DevOps-by-examples_2016"}},"isPrimary":true}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","retentionPolicy":null,"url":"https://giuliovaad.vsrm.visualstudio.com/DevOps-by-examples_2016/_apis/Release/definitions/3","_links":{"self":{"href":"https://giuliovaad.vsrm.visualstudio.com/DevOps-by-examples_2016/_apis/Release/definitions/3"},"web":{"href":"https://giuliovaad.visualstudio.com/9a98d6ba-d874-4a38-bd0e-7f12a4b8f891/_apps/hub/ms.vss-releaseManagement-web.hub-explorer?definitionId=3"}}}